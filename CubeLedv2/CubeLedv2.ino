/*
 * Commande d'un cube à LED
 */

#include "Tlc5940.h"

/* Tableau de correspondance x, y -> Canal TLC :
   tlc_order[y][x] = Canal TLC
 */

unsigned int const PROGMEM ANIMATION[] = {
  // Transfert cube
0x00ff, 0x8064,
0x01ff, 0x04ff, 0x05ff, 0x10ff, 0x11ff, 0x14ff, 0x15ff, 0x8064,
0x02ff, 0x06ff, 0x08ff, 0x09ff, 0x0aff, 0x12ff, 0x16ff, 0x18ff, 0x19ff, 0x1aff, 0x20ff, 0x21ff, 0x22ff, 0x24ff, 0x25ff, 0x26ff, 0x28ff, 0x29ff, 0x2aff, 0x8064,
0x03ff, 0x07ff, 0x0bff, 0x0cff, 0x0dff, 0x0eff, 0x0fff, 0x13ff, 0x17ff, 0x1bff, 0x1cff, 0x1dff, 0x1eff, 0x1fff, 0x23ff, 0x27ff, 0x2bff, 0x2cff, 0x2dff, 0x2eff, 0x2fff, 0x30ff, 0x31ff, 0x32ff, 0x33ff, 0x34ff, 0x35ff, 0x36ff, 0x37ff, 0x38ff, 0x39ff, 0x3aff, 0x3bff, 0x3cff, 0x3dff, 0x3eff, 0x3fff, 0x8064,
0x0000, 0x0100, 0x0200, 0x0300, 0x0400, 0x0500, 0x0600, 0x0700, 0x0800, 0x0900, 0x0a00, 0x0b00, 0x0c00, 0x0d00, 0x0e00, 0x0f00, 0x1000, 0x1100, 0x1200, 0x1300, 0x1400, 0x1800, 0x1c00, 0x2000, 0x2100, 0x2200, 0x2300, 0x2400, 0x2800, 0x2c00, 0x3000, 0x3100, 0x3200, 0x3300, 0x3400, 0x3800, 0x3c00, 0x8064,
0x1500, 0x1600, 0x1700, 0x1900, 0x1a00, 0x1b00, 0x1d00, 0x1e00, 0x1f00, 0x2500, 0x2600, 0x2700, 0x2900, 0x2d00, 0x3500, 0x3600, 0x3700, 0x3900, 0x3d00, 0x8064,
0x2a00, 0x2b00, 0x2e00, 0x2f00, 0x3a00, 0x3b00, 0x3e00, 0x8064,
0x3f00, 0x8064,
0x03ff, 0x8064,
0x02ff, 0x06ff, 0x07ff, 0x12ff, 0x13ff, 0x16ff, 0x17ff, 0x8064,
0x01ff, 0x05ff, 0x09ff, 0x0aff, 0x0bff, 0x11ff, 0x15ff, 0x19ff, 0x1aff, 0x1bff, 0x21ff, 0x22ff, 0x23ff, 0x25ff, 0x26ff, 0x27ff, 0x29ff, 0x2aff, 0x2bff, 0x8064,
0x00ff, 0x04ff, 0x08ff, 0x0cff, 0x0dff, 0x0eff, 0x0fff, 0x10ff, 0x14ff, 0x18ff, 0x1cff, 0x1dff, 0x1eff, 0x1fff, 0x20ff, 0x24ff, 0x28ff, 0x2cff, 0x2dff, 0x2eff, 0x2fff, 0x30ff, 0x31ff, 0x32ff, 0x33ff, 0x34ff, 0x35ff, 0x36ff, 0x37ff, 0x38ff, 0x39ff, 0x3aff, 0x3bff, 0x3cff, 0x3dff, 0x3eff, 0x3fff, 0x8064,
0x0000, 0x0100, 0x0200, 0x0300, 0x0400, 0x0500, 0x0600, 0x0700, 0x0800, 0x0900, 0x0a00, 0x0b00, 0x0c00, 0x0d00, 0x0e00, 0x0f00, 0x1000, 0x1100, 0x1200, 0x1300, 0x1700, 0x1b00, 0x1f00, 0x2000, 0x2100, 0x2200, 0x2300, 0x2700, 0x2b00, 0x2f00, 0x3000, 0x3100, 0x3200, 0x3300, 0x3700, 0x3b00, 0x3f00, 0x8064,
0x1400, 0x1500, 0x1600, 0x1800, 0x1900, 0x1a00, 0x1c00, 0x1d00, 0x1e00, 0x2400, 0x2500, 0x2600, 0x2a00, 0x2e00, 0x3400, 0x3500, 0x3600, 0x3a00, 0x3e00, 0x8064,
0x2800, 0x2900, 0x2d00, 0x3800, 0x3900, 0x3c00, 0x3d00, 0x8064,
0x2c00, 0x8064,
0x0fff, 0x8064,
0x0aff, 0x0bff, 0x0eff, 0x1aff, 0x1bff, 0x1eff, 0x1fff, 0x8064,
0x05ff, 0x06ff, 0x07ff, 0x09ff, 0x0dff, 0x15ff, 0x16ff, 0x17ff, 0x19ff, 0x1dff, 0x25ff, 0x26ff, 0x27ff, 0x29ff, 0x2aff, 0x2bff, 0x2dff, 0x2eff, 0x2fff, 0x8064,
0x00ff, 0x01ff, 0x02ff, 0x03ff, 0x04ff, 0x08ff, 0x0cff, 0x10ff, 0x11ff, 0x12ff, 0x13ff, 0x14ff, 0x18ff, 0x1cff, 0x20ff, 0x21ff, 0x22ff, 0x23ff, 0x24ff, 0x28ff, 0x2cff, 0x30ff, 0x31ff, 0x32ff, 0x33ff, 0x34ff, 0x35ff, 0x36ff, 0x37ff, 0x38ff, 0x39ff, 0x3aff, 0x3bff, 0x3cff, 0x3dff, 0x3eff, 0x3fff, 0x8064,
0x0000, 0x0100, 0x0200, 0x0300, 0x0400, 0x0500, 0x0600, 0x0700, 0x0800, 0x0900, 0x0a00, 0x0b00, 0x0c00, 0x0d00, 0x0e00, 0x0f00, 0x1300, 0x1700, 0x1b00, 0x1c00, 0x1d00, 0x1e00, 0x1f00, 0x2300, 0x2700, 0x2b00, 0x2c00, 0x2d00, 0x2e00, 0x2f00, 0x3300, 0x3700, 0x3b00, 0x3c00, 0x3d00, 0x3e00, 0x3f00, 0x8064,
0x1000, 0x1100, 0x1200, 0x1400, 0x1500, 0x1600, 0x1800, 0x1900, 0x1a00, 0x2200, 0x2600, 0x2800, 0x2900, 0x2a00, 0x3200, 0x3600, 0x3800, 0x3900, 0x3a00, 0x8064,
0x2000, 0x2100, 0x2400, 0x2500, 0x3100, 0x3400, 0x3500, 0x8064,
0x3000, 0x8064,
0x0cff, 0x8064,
0x08ff, 0x09ff, 0x0dff, 0x18ff, 0x19ff, 0x1cff, 0x1dff, 0x8064,
0x04ff, 0x05ff, 0x06ff, 0x0aff, 0x0eff, 0x14ff, 0x15ff, 0x16ff, 0x1aff, 0x1eff, 0x24ff, 0x25ff, 0x26ff, 0x28ff, 0x29ff, 0x2aff, 0x2cff, 0x2dff, 0x2eff, 0x8064,
0x00ff, 0x01ff, 0x02ff, 0x03ff, 0x07ff, 0x0bff, 0x0fff, 0x10ff, 0x11ff, 0x12ff, 0x13ff, 0x17ff, 0x1bff, 0x1fff, 0x20ff, 0x21ff, 0x22ff, 0x23ff, 0x27ff, 0x2bff, 0x2fff, 0x30ff, 0x31ff, 0x32ff, 0x33ff, 0x34ff, 0x35ff, 0x36ff, 0x37ff, 0x38ff, 0x39ff, 0x3aff, 0x3bff, 0x3cff, 0x3dff, 0x3eff, 0x3fff, 0x8064,
0x0000, 0x0100, 0x0200, 0x0300, 0x0400, 0x0500, 0x0600, 0x0700, 0x0800, 0x0900, 0x0a00, 0x0b00, 0x0c00, 0x0d00, 0x0e00, 0x0f00, 0x1000, 0x1400, 0x1800, 0x1c00, 0x1d00, 0x1e00, 0x1f00, 0x2000, 0x2400, 0x2800, 0x2c00, 0x2d00, 0x2e00, 0x2f00, 0x3000, 0x3400, 0x3800, 0x3c00, 0x3d00, 0x3e00, 0x3f00, 0x8064,
0x1100, 0x1200, 0x1300, 0x1500, 0x1600, 0x1700, 0x1900, 0x1a00, 0x1b00, 0x2100, 0x2500, 0x2900, 0x2a00, 0x2b00, 0x3100, 0x3500, 0x3900, 0x3a00, 0x3b00, 0x8064,
0x2200, 0x2300, 0x2600, 0x2700, 0x3200, 0x3600, 0x3700, 0x8064,
0x3300, 0x8064,

/*
 // Helicoidale
  0x00ff, 0x05ff, 0x0aff, 0x0fff, 0x11ff, 0x15ff, 0x1aff, 0x1eff, 0x22ff, 0x26ff, 0x29ff, 0x2dff, 0x33ff, 0x36ff, 0x39ff, 0x3cff, 0x8064,
0x0000, 0x01ff, 0x0eff, 0x0f00, 0x1100, 0x12ff, 0x1500, 0x16ff, 0x19ff, 0x1a00, 0x1dff, 0x1e00, 0x2200, 0x23ff, 0x2cff, 0x2d00, 0x3300, 0x37ff, 0x38ff, 0x3c00, 0x8064,
0x0100, 0x02ff, 0x0500, 0x06ff, 0x09ff, 0x0a00, 0x0dff, 0x0e00, 0x1200, 0x13ff, 0x1cff, 0x1d00, 0x2300, 0x27ff, 0x28ff, 0x2c00, 0x34ff, 0x35ff, 0x3600, 0x3700, 0x3800, 0x3900, 0x3aff, 0x3bff, 0x8064,
0x0200, 0x03ff, 0x0cff, 0x0d00, 0x1300, 0x17ff, 0x18ff, 0x1c00, 0x24ff, 0x25ff, 0x2600, 0x2700, 0x2800, 0x2900, 0x2aff, 0x2bff, 0x30ff, 0x3400, 0x3b00, 0x3fff, 0x8064,
0x0300, 0x07ff, 0x08ff, 0x0c00, 0x14ff, 0x15ff, 0x1600, 0x1700, 0x1800, 0x1900, 0x1aff, 0x1bff, 0x20ff, 0x2400, 0x2b00, 0x2fff, 0x3000, 0x31ff, 0x3eff, 0x3f00, 0x8064,
0x04ff, 0x05ff, 0x0600, 0x0700, 0x0800, 0x0900, 0x0aff, 0x0bff, 0x10ff, 0x1400, 0x1b00, 0x1fff, 0x2000, 0x21ff, 0x2eff, 0x2f00, 0x3100, 0x32ff, 0x3500, 0x36ff, 0x39ff, 0x3a00, 0x3dff, 0x3e00, 0x8064,
//0x00ff, 0x0400, 0x0b00, 0x0fff, 0x1000, 0x11ff, 0x1eff, 0x1f00, 0x2100, 0x22ff, 0x2500, 0x26ff, 0x29ff, 0x2a00, 0x2dff, 0x2e00, 0x3200, 0x33ff, 0x3cff, 0x3d00, 0x8064,

 // Snake

  0x00ff,0x01ff,0x2a96,0x8064,
  0x0000,0x02ff,0x8064,
  0x0100,0x06ff,0x8064,
  0x0200,0x0aff,0x8064,
  0x0600,0x1aff,0x8064,
  0x0a00,0x2aff,0x8064,
  0x3aff,0x8064,
  0x1a00,0x3596,0x3bff,0x8064,
  0x2a00,0x37ff,0x8064,
  0x36ff,0x3a00,0x8064,
  0x35ff,0x3b00,0x8064,
  0x0096,0x34ff,0x8064,
  0x24ff,0x3700,0x8064,
  0x14ff,0x3600,0x8064,
  0x04ff,0x3500,0x8064,
  0x00ff,0x3400,0x8064,
  0x01ff,0x2b96,0x8064,
  0x02ff,0x2400,0x8064,
  0x03ff,0x1400,0x8064,
  0x0400,0x13ff,0x8064,
  0x0000,0x23ff,0x8064,
  0x0100,0x27ff,0x8064,
  0x0200,0x2c96,0x2bff,0x8064,
  0x2fff,0x8064,
  0x0300,0x2eff,0x8064,
  0x1300,0x2dff,0x8064,
  0x2cff,0x2300,0x8064,
  0x28ff,0x8064,
  0x1396,0x24ff,0x2700,0x8064,
  0x20ff,0x2b00,0x8064,
  0x10ff,0x2f00,0x8064,
  0x00ff,0x2e00,0x3c96,0x8064,
  0x01ff,0x2d00,0x8064,
  0x02ff,0x2c00,0x8064,
  0x0a96,0x03ff,0x2800,0x2c96,0x8064,
  0x13ff,0x2400,0x8064,
  0x23ff,0x8064,
  0x2000,0x33ff,0x8064,
  0x1000,0x37ff,0x8064,
  0x0000,0x3bff,0x8064,
  0x0100,0x3fff,0x8064,
  0x0200,0x3eff,0x8064,
  0x0300,0x3dff,0x8064,
  0x1300,0x3cff,0x8064,
  0x2cff,0x8064,
  0x1cff,0x8064,
  0x0cff,0x2300,0x8064,
  0x08ff,0x3300,0x8064,
  0x04ff,0x3700,0x8064,
  0x00ff,0x3b00,0x8064,
  0x01ff,0x3f00,0x8064,
  0x02ff,0x3e00,0x8064,
  0x06ff,0x3d00,0x8064,
  0x0aff,0x3c00,0x8064,
  0x0eff,0x8064,
  0x1eff,0x2c00,0x8064,
  0x0c00,0x1c00,0x2eff,0x8064,
  0x0800,0x3eff,0x8064,
  0x0400,0x3fff,0x8064,
  0x0000,0x2fff,0x8064,
  0x0100,0x1fff,0x8064,
  0x0200,0x0fff,0x2f00,0x8064,
  0x0600,0x0bff,0x2fff,0x8064,
  0x0a00,0x8064,
  0x0e00,0x07ff,0x8064,
  0x03ff,0x1e00,0x8064,
  0x02ff,0x2e00,0x8064,
  0x01ff,0x3e00,0x8064,
  0x00ff,0x3f00,0x8064,
  0x04ff,0x0d96,0x1196,0x2496,0x2696,0x2f00,0x3c96,0x3396,0x8064,
  0x08ff,0x1f00,0x8064,
  0x0cff,0x0f00,0x8064,
  0x0dff,0x0b00,0x8064,
  0x0eff,0x8064,
  0x0700,0x1eff,0x8064,
  0x0300,0x1aff,0x8064,
  0x0200,0x16ff,0x8064,
  0x0100,0x12ff,0x8064,
  0x0000,0x11ff,0x8064,
  0x21ff,0x8064,
  0x0400,0x31ff,0x8064,
  0x0800,0x32ff,0x8064,
  0x0c00,0x33ff,0x8064,
  0x37ff,0x8064,
  0x0d00,0x3bff,0x8064,
  0x0e00,0x3fff,0x8064,
  0x1e00,0x3eff,0x8064,
  0x1a00,0x3dff,0x8064,
  0x1600,0x3cff,0x8064,
  0x1200,0x2cff,0x8064,
  0x1100,0x2dff,0x8064,
  0x2eff,0x8064,
  0x2100,0x2aff,0x8064,
  0x26ff,0x3100,0x8064,
  0x22ff,0x8064,
  0x21ff,0x3200,0x8064,
  0x20ff,0x3300,0x8064,
  0x24ff,0x3700,0x8064,
  0x8064,
  0x14ff,0x3b00,0x8064,
  0x04ff,0x3f00,0x8064,
  0x05ff,0x3e00,0x8064,
  0x06ff,0x3d00,0x8064,
  0x07ff,0x3c00,0x8064,
  0x0bff,0x2c00,0x8064,
  0x0aff,0x2d00,0x8064,
  0x0eff,0x2e00,0x8064,
  0x0dff,0x2a00,0x8064,
  0x1dff,0x2600,0x8064,
  0x1eff,0x2200,0x8064,
  0x1aff,0x2100,0x8064,
  0x1bff,0x2000,0x8064,
  0x1fff,0x2400,0x8064,
  0x0fff,0x1400,0x8064,
  0x0400,0x0500,0x0d00,0x0600,0x0a00,0x0e00,0x0700,0x0b00,0x0f00,0x1d00,0x1a00,0x1e00,0x1b00,0x1f00,0x80c8,
  0x04ff,0x05ff,0x0dff,0x06ff,0x0aff,0x0eff,0x07ff,0x0bff,0x0fff,0x1dff,0x1aff,0x1eff,0x1bff,0x1fff,0x80c8,
  0x0400,0x0500,0x0d00,0x0600,0x0a00,0x0e00,0x0700,0x0b00,0x0f00,0x1d00,0x1a00,0x1e00,0x1b00,0x1f00,0x80c8,
  0x04ff,0x05ff,0x0dff,0x06ff,0x0aff,0x0eff,0x07ff,0x0bff,0x0fff,0x1dff,0x1aff,0x1eff,0x1bff,0x1fff,0x80c8,
  0x0400,0x0500,0x0d00,0x0600,0x0a00,0x0e00,0x0700,0x0b00,0x0f00,0x1d00,0x1a00,0x1e00,0x1b00,0x1f00,0x80c8,
  0x04ff,0x05ff,0x0dff,0x06ff,0x0aff,0x0eff,0x07ff,0x0bff,0x0fff,0x1dff,0x1aff,0x1eff,0x1bff,0x1fff,0x80c8,
  0x0400,0x0500,0x0d00,0x0600,0x0a00,0x0e00,0x0700,0x0b00,0x0f00,0x1d00,0x1a00,0x1e00,0x1b00,0x1f00,0x83e8,


    0xc000, // reset

  // Rain

    0x0cff, 0x8096,
    0x8096,
    0x8096,
    0x3eff, 0x8096,
    0x0c00, 0x0dff, 0x8096,
    0x0d00, 0x0eff, 0x2eff, 0x3e00, 0x8096,
    0x8096,
    0x1eff, 0x2e00, 0x30ff, 0x8096,
    0x0aff, 0x0e00, 0x1aff, 0x1e00, 0x8096,
    0x09ff, 0x0a00, 0x19ff, 0x1a00, 0x20ff, 0x3000, 0x8096,
    0x05ff, 0x0900, 0x15ff, 0x1900, 0x8096,
    0x01ff, 0x0500, 0x10ff, 0x11ff, 0x1500, 0x2000, 0x8096,
    0x3cff, 0x8096,
    0x0100, 0x05ff, 0x1000, 0x1100, 0x14ff, 0x15ff, 0x8096,
    0x0500, 0x09ff, 0x1400, 0x1500, 0x18ff, 0x19ff, 0x2cff, 0x3c00, 0x8096,
    0x0900, 0x0dff, 0x1800, 0x1900, 0x1cff, 0x1dff, 0x8096,
    0x37ff, 0x8096,
    0x0d00, 0x0eff, 0x1c00, 0x1eff, 0x2c00, 0x2dff, 0x8096,
    0x0aff, 0x0e00, 0x19ff, 0x1aff, 0x1d00, 0x1e00, 0x27ff, 0x29ff, 0x2d00, 0x3700, 0x8096,
    0x06ff, 0x0a00, 0x15ff, 0x16ff, 0x1900, 0x1a00, 0x25ff, 0x2900, 0x8096,
    0x17ff, 0x2700, 0x8096,
    0x3eff, 0x8096,
    0x0600, 0x0aff, 0x1500, 0x1600, 0x1700, 0x19ff, 0x1aff, 0x1bff, 0x2500, 0x29ff, 0x8096,
    0x0a00, 0x0eff, 0x1900, 0x1a00, 0x1b00, 0x1dff, 0x1eff, 0x1fff, 0x2900, 0x2dff, 0x2eff, 0x3e00, 0x8096,
    0x30ff, 0x8096,
    0x0dff, 0x0e00, 0x1cff, 0x1f00, 0x2cff, 0x2e00, 0x8096,
    0x09ff, 0x0d00, 0x18ff, 0x19ff, 0x1aff, 0x1c00, 0x1d00, 0x1e00, 0x20ff, 0x28ff, 0x29ff, 0x2c00, 0x2d00, 0x3000, 0x8096,
    0x05ff, 0x0900, 0x14ff, 0x15ff, 0x16ff, 0x1800, 0x1900, 0x1a00, 0x24ff, 0x25ff, 0x2800, 0x2900, 0x8096,
    0x3aff, 0x8096,
    0x0500, 0x06ff, 0x1400, 0x17ff, 0x2000, 0x21ff, 0x2400, 0x26ff, 0x8096,
    0x2aff, 0x3a00, 0x8096,
    0x3cff, 0x8096,
    0x0600, 0x0aff, 0x1500, 0x1600, 0x1700, 0x19ff, 0x1aff, 0x1bff, 0x2100, 0x2600, 0x29ff, 0x2eff, 0x8096,
    0x09ff, 0x0a00, 0x18ff, 0x1b00, 0x24ff, 0x2500, 0x28ff, 0x2a00, 0x2cff, 0x2dff, 0x2e00, 0x3c00, 0x8096,
    0x33ff, 0x8096,
    0x0900, 0x0aff, 0x1800, 0x1bff, 0x2400, 0x25ff, 0x2800, 0x2aff, 0x2c00, 0x2eff, 0x8096,
    0x06ff, 0x0a00, 0x15ff, 0x16ff, 0x17ff, 0x1900, 0x1a00, 0x1b00, 0x21ff, 0x23ff, 0x26ff, 0x2d00, 0x2e00, 0x3300, 0x8096,
    0x8096,
    0x13ff, 0x2300, 0x8096,
    0x3fff, 0x8096,
    0x0600, 0x0aff, 0x1300, 0x1500, 0x1600, 0x19ff, 0x1aff, 0x1bff, 0x2100, 0x2600, 0x2dff, 0x2eff, 0x8096,
    0x2fff, 0x3f00, 0x8096,
    0x33ff, 0x8096,
    0x06ff, 0x0a00, 0x13ff, 0x15ff, 0x16ff, 0x1900, 0x1a00, 0x1b00, 0x21ff, 0x26ff, 0x2bff, 0x2d00, 0x2e00, 0x2f00, 0x8096,
    0x23ff, 0x3300, 0x8096,
    0x3cff, 0x8096,
    0x05ff, 0x0600, 0x12ff, 0x1300, 0x14ff, 0x1700, 0x20ff, 0x2100, 0x22ff, 0x2300, 0x24ff, 0x2600, 0x28ff, 0x2b00, 0x8096,
    0x2cff, 0x3c00, 0x8096,
    0x3fff, 0x8096,
    0x0500, 0x06ff, 0x1200, 0x13ff, 0x1400, 0x17ff, 0x2000, 0x21ff, 0x2200, 0x23ff, 0x2400, 0x26ff, 0x2800, 0x2bff, 0x2c00, 0x2dff, 0x8096,
    0x2fff, 0x3f00, 0x8096,
    0x38ff, 0x8096,
    0x05ff, 0x0600, 0x12ff, 0x1300, 0x14ff, 0x1700, 0x20ff, 0x2100, 0x22ff, 0x2300, 0x24ff, 0x2600, 0x28ff, 0x2b00, 0x2cff, 0x2d00, 0x2eff, 0x2f00, 0x8096,
    0x0500, 0x1200, 0x1400, 0x1500, 0x1600, 0x2000, 0x2200, 0x2400, 0x2500, 0x2800, 0x2900, 0x2a00, 0x2c00, 0x2e00, 0x30ff, 0x31ff, 0x32ff, 0x33ff, 0x34ff, 0x35ff, 0x36ff, 0x37ff, 0x39ff, 0x3aff, 0x3bff, 0x3cff, 0x3dff, 0x3eff, 0x3fff, 0x8064,
    0x20ff, 0x21ff, 0x22ff, 0x23ff, 0x24ff, 0x25ff, 0x26ff, 0x27ff, 0x28ff, 0x29ff, 0x2aff, 0x2bff, 0x2cff, 0x2dff, 0x2eff, 0x2fff, 0x30cc, 0x31cc, 0x32cc, 0x33cc, 0x34cc, 0x35cc, 0x36cc, 0x37cc, 0x38cc, 0x39cc, 0x3acc, 0x3bcc, 0x3ccc, 0x3dcc, 0x3ecc, 0x3fcc, 0x8064,
    0x10ff, 0x11ff, 0x12ff, 0x13ff, 0x14ff, 0x15ff, 0x16ff, 0x17ff, 0x18ff, 0x19ff, 0x1aff, 0x1bff, 0x1cff, 0x1dff, 0x1eff, 0x1fff, 0x20cc, 0x21cc, 0x22cc, 0x23cc, 0x24cc, 0x25cc, 0x26cc, 0x27cc, 0x28cc, 0x29cc, 0x2acc, 0x2bcc, 0x2ccc, 0x2dcc, 0x2ecc, 0x2fcc, 0x3099, 0x3199, 0x3299, 0x3399, 0x3499, 0x3599, 0x3699, 0x3799, 0x3899, 0x3999, 0x3a99, 0x3b99, 0x3c99, 0x3d99, 0x3e99, 0x3f99, 0x8064,
    0x00ff, 0x01ff, 0x02ff, 0x03ff, 0x04ff, 0x05ff, 0x06ff, 0x07ff, 0x08ff, 0x09ff, 0x0aff, 0x0bff, 0x0cff, 0x0dff, 0x0eff, 0x0fff, 0x10cc, 0x11cc, 0x12cc, 0x13cc, 0x14cc, 0x15cc, 0x16cc, 0x17cc, 0x18cc, 0x19cc, 0x1acc, 0x1bcc, 0x1ccc, 0x1dcc, 0x1ecc, 0x1fcc, 0x2099, 0x2199, 0x2299, 0x2399, 0x2499, 0x2599, 0x2699, 0x2799, 0x2899, 0x2999, 0x2a99, 0x2b99, 0x2c99, 0x2d99, 0x2e99, 0x2f99, 0x3066, 0x3166, 0x3266, 0x3366, 0x3466, 0x3566, 0x3666, 0x3766, 0x3866, 0x3966, 0x3a66, 0x3b66, 0x3c66, 0x3d66, 0x3e66, 0x3f66, 0x8064,
    0x00cc, 0x01cc, 0x02cc, 0x03cc, 0x04cc, 0x05cc, 0x06cc, 0x07cc, 0x08cc, 0x09cc, 0x0acc, 0x0bcc, 0x0ccc, 0x0dcc, 0x0ecc, 0x0fcc, 0x1099, 0x1199, 0x1299, 0x1399, 0x1499, 0x1599, 0x1699, 0x1799, 0x1899, 0x1999, 0x1a99, 0x1b99, 0x1c99, 0x1d99, 0x1e99, 0x1f99, 0x2066, 0x2166, 0x2266, 0x2366, 0x2466, 0x2566, 0x2666, 0x2766, 0x2866, 0x2966, 0x2a66, 0x2b66, 0x2c66, 0x2d66, 0x2e66, 0x2f66, 0x3033, 0x3133, 0x3233, 0x3333, 0x3433, 0x3533, 0x3633, 0x3733, 0x3833, 0x3933, 0x3a33, 0x3b33, 0x3c33, 0x3d33, 0x3e33, 0x3f33, 0x8064,
    0x0099, 0x0199, 0x0299, 0x0399, 0x0499, 0x0599, 0x0699, 0x0799, 0x0899, 0x0999, 0x0a99, 0x0b99, 0x0c99, 0x0d99, 0x0e99, 0x0f99, 0x1066, 0x1166, 0x1266, 0x1366, 0x1466, 0x1566, 0x1666, 0x1766, 0x1866, 0x1966, 0x1a66, 0x1b66, 0x1c66, 0x1d66, 0x1e66, 0x1f66, 0x2033, 0x2133, 0x2233, 0x2333, 0x2433, 0x2533, 0x2633, 0x2733, 0x2833, 0x2933, 0x2a33, 0x2b33, 0x2c33, 0x2d33, 0x2e33, 0x2f33, 0x3000, 0x3100, 0x3200, 0x3300, 0x3400, 0x3500, 0x3600, 0x3700, 0x3800, 0x3900, 0x3a00, 0x3b00, 0x3c00, 0x3d00, 0x3e00, 0x3f00, 0x8064,
    0x0066, 0x0166, 0x0266, 0x0366, 0x0466, 0x0566, 0x0666, 0x0766, 0x0866, 0x0966, 0x0a66, 0x0b66, 0x0c66, 0x0d66, 0x0e66, 0x0f66, 0x1033, 0x1133, 0x1233, 0x1333, 0x1433, 0x1533, 0x1633, 0x1733, 0x1833, 0x1933, 0x1a33, 0x1b33, 0x1c33, 0x1d33, 0x1e33, 0x1f33, 0x2000, 0x2100, 0x2200, 0x2300, 0x2400, 0x2500, 0x2600, 0x2700, 0x2800, 0x2900, 0x2a00, 0x2b00, 0x2c00, 0x2d00, 0x2e00, 0x2f00, 0x8064,
    0x0033, 0x0133, 0x0233, 0x0333, 0x0433, 0x0533, 0x0633, 0x0733, 0x0833, 0x0933, 0x0a33, 0x0b33, 0x0c33, 0x0d33, 0x0e33, 0x0f33, 0x1000, 0x1100, 0x1200, 0x1300, 0x1400, 0x1500, 0x1600, 0x1700, 0x1800, 0x1900, 0x1a00, 0x1b00, 0x1c00, 0x1d00, 0x1e00, 0x1f00, 0x8064,
    0x0000, 0x0100, 0x0200, 0x0300, 0x0400, 0x0500, 0x0600, 0x0700, 0x0800, 0x0900, 0x0a00, 0x0b00, 0x0c00, 0x0d00, 0x0e00, 0x0f00, 0x8064,
    0x8064,
    0x8020,
    0x00ff, 0x01ff, 0x02ff, 0x03ff, 0x04ff, 0x05ff, 0x06ff, 0x07ff, 0x08ff, 0x09ff, 0x0aff, 0x0bff, 0x0cff, 0x0dff, 0x0eff, 0x0fff, 0x8020,
    0x0000, 0x0100, 0x0200, 0x0300, 0x0400, 0x0500, 0x0600, 0x0700, 0x0800, 0x0900, 0x0a00, 0x0b00, 0x0c00, 0x0d00, 0x0e00, 0x0f00, 0x10ff, 0x11ff, 0x12ff, 0x13ff, 0x14ff, 0x15ff, 0x16ff, 0x17ff, 0x18ff, 0x19ff, 0x1aff, 0x1bff, 0x1cff, 0x1dff, 0x1eff, 0x1fff, 0x8020,
    0x1000, 0x1100, 0x1200, 0x1300, 0x1400, 0x1500, 0x1600, 0x1700, 0x1800, 0x1900, 0x1a00, 0x1b00, 0x1c00, 0x1d00, 0x1e00, 0x1f00, 0x20ff, 0x21ff, 0x22ff, 0x23ff, 0x24ff, 0x25ff, 0x26ff, 0x27ff, 0x28ff, 0x29ff, 0x2aff, 0x2bff, 0x2cff, 0x2dff, 0x2eff, 0x2fff, 0x8020,
    0x2000, 0x2100, 0x2200, 0x2300, 0x2400, 0x2500, 0x2600, 0x2700, 0x2800, 0x2900, 0x2a00, 0x2b00, 0x2c00, 0x2d00, 0x2e00, 0x2f00, 0x30ff, 0x31ff, 0x32ff, 0x33ff, 0x34ff, 0x35ff, 0x36ff, 0x37ff, 0x38ff, 0x39ff, 0x3aff, 0x3bff, 0x3cff, 0x3dff, 0x3eff, 0x3fff, 0x8020,
    0x3000, 0x3100, 0x3200, 0x3300, 0x3400, 0x3500, 0x3600, 0x3700, 0x3800, 0x3900, 0x3a00, 0x3b00, 0x3c00, 0x3d00, 0x3e00, 0x3f00, 0x8020,
    0x00ff, 0x01ff, 0x02ff, 0x03ff, 0x04ff, 0x05ff, 0x06ff, 0x07ff, 0x08ff, 0x09ff, 0x0aff, 0x0bff, 0x0cff, 0x0dff, 0x0eff, 0x0fff, 0x10ff, 0x11ff, 0x12ff, 0x13ff, 0x14ff, 0x15ff, 0x16ff, 0x17ff, 0x18ff, 0x19ff, 0x1aff, 0x1bff, 0x1cff, 0x1dff, 0x1eff, 0x1fff, 0x20ff, 0x21ff, 0x22ff, 0x23ff, 0x24ff, 0x25ff, 0x26ff, 0x27ff, 0x28ff, 0x29ff, 0x2aff, 0x2bff, 0x2cff, 0x2dff, 0x2eff, 0x2fff, 0x30ff, 0x31ff, 0x32ff, 0x33ff, 0x34ff, 0x35ff, 0x36ff, 0x37ff, 0x38ff, 0x39ff, 0x3aff, 0x3bff, 0x3cff, 0x3dff, 0x3eff, 0x3fff, 0x8020,
    0x0000, 0x0100, 0x0200, 0x0300, 0x0400, 0x0500, 0x0600, 0x0700, 0x0800, 0x0900, 0x0a00, 0x0b00, 0x0c00, 0x0d00, 0x0e00, 0x0f00, 0x1000, 0x1100, 0x1200, 0x1300, 0x1400, 0x1500, 0x1600, 0x1700, 0x1800, 0x1900, 0x1a00, 0x1b00, 0x1c00, 0x1d00, 0x1e00, 0x1f00, 0x2000, 0x2100, 0x2200, 0x2300, 0x2400, 0x2500, 0x2600, 0x2700, 0x2800, 0x2900, 0x2a00, 0x2b00, 0x2c00, 0x2d00, 0x2e00, 0x2f00, 0x3000, 0x3100, 0x3200, 0x3300, 0x3400, 0x3500, 0x3600, 0x3700, 0x3800, 0x3900, 0x3a00, 0x3b00, 0x3c00, 0x3d00, 0x3e00, 0x3f00, 0x8020,
    0x00ff, 0x01ff, 0x02ff, 0x03ff, 0x04ff, 0x05ff, 0x06ff, 0x07ff, 0x08ff, 0x09ff, 0x0aff, 0x0bff, 0x0cff, 0x0dff, 0x0eff, 0x0fff, 0x10ff, 0x11ff, 0x12ff, 0x13ff, 0x14ff, 0x15ff, 0x16ff, 0x17ff, 0x18ff, 0x19ff, 0x1aff, 0x1bff, 0x1cff, 0x1dff, 0x1eff, 0x1fff, 0x20ff, 0x21ff, 0x22ff, 0x23ff, 0x24ff, 0x25ff, 0x26ff, 0x27ff, 0x28ff, 0x29ff, 0x2aff, 0x2bff, 0x2cff, 0x2dff, 0x2eff, 0x2fff, 0x30ff, 0x31ff, 0x32ff, 0x33ff, 0x34ff, 0x35ff, 0x36ff, 0x37ff, 0x38ff, 0x39ff, 0x3aff, 0x3bff, 0x3cff, 0x3dff, 0x3eff, 0x3fff, 0x8020,
    0x0000, 0x0100, 0x0200, 0x0300, 0x0400, 0x0500, 0x0600, 0x0700, 0x0800, 0x0900, 0x0a00, 0x0b00, 0x0c00, 0x0d00, 0x0e00, 0x0f00, 0x1000, 0x1100, 0x1200, 0x1300, 0x1400, 0x1500, 0x1600, 0x1700, 0x1800, 0x1900, 0x1a00, 0x1b00, 0x1c00, 0x1d00, 0x1e00, 0x1f00, 0x2000, 0x2100, 0x2200, 0x2300, 0x2400, 0x2500, 0x2600, 0x2700, 0x2800, 0x2900, 0x2a00, 0x2b00, 0x2c00, 0x2d00, 0x2e00, 0x2f00, 0x3000, 0x3100, 0x3200, 0x3300, 0x3400, 0x3500, 0x3600, 0x3700, 0x3800, 0x3900, 0x3a00, 0x3b00, 0x3c00, 0x3d00, 0x3e00, 0x3f00, 0x8020,
    0x00ff, 0x01ff, 0x02ff, 0x03ff, 0x04ff, 0x05ff, 0x06ff, 0x07ff, 0x08ff, 0x09ff, 0x0aff, 0x0bff, 0x0cff, 0x0dff, 0x0eff, 0x0fff, 0x10ff, 0x11ff, 0x12ff, 0x13ff, 0x14ff, 0x15ff, 0x16ff, 0x17ff, 0x18ff, 0x19ff, 0x1aff, 0x1bff, 0x1cff, 0x1dff, 0x1eff, 0x1fff, 0x20ff, 0x21ff, 0x22ff, 0x23ff, 0x24ff, 0x25ff, 0x26ff, 0x27ff, 0x28ff, 0x29ff, 0x2aff, 0x2bff, 0x2cff, 0x2dff, 0x2eff, 0x2fff, 0x30ff, 0x31ff, 0x32ff, 0x33ff, 0x34ff, 0x35ff, 0x36ff, 0x37ff, 0x38ff, 0x39ff, 0x3aff, 0x3bff, 0x3cff, 0x3dff, 0x3eff, 0x3fff, 0x8020,
    0x0000, 0x0100, 0x0200, 0x0300, 0x0400, 0x0500, 0x0600, 0x0700, 0x0800, 0x0900, 0x0a00, 0x0b00, 0x0c00, 0x0d00, 0x0e00, 0x0f00, 0x1000, 0x1100, 0x1200, 0x1300, 0x1400, 0x1500, 0x1600, 0x1700, 0x1800, 0x1900, 0x1a00, 0x1b00, 0x1c00, 0x1d00, 0x1e00, 0x1f00, 0x2000, 0x2100, 0x2200, 0x2300, 0x2400, 0x2500, 0x2600, 0x2700, 0x2800, 0x2900, 0x2a00, 0x2b00, 0x2c00, 0x2d00, 0x2e00, 0x2f00, 0x3000, 0x3100, 0x3200, 0x3300, 0x3400, 0x3500, 0x3600, 0x3700, 0x3800, 0x3900, 0x3a00, 0x3b00, 0x3c00, 0x3d00, 0x3e00, 0x3f00, 0x8020,
    0x00ff, 0x01ff, 0x02ff, 0x03ff, 0x04ff, 0x05ff, 0x06ff, 0x07ff, 0x08ff, 0x09ff, 0x0aff, 0x0bff, 0x0cff, 0x0dff, 0x0eff, 0x0fff, 0x10ff, 0x11ff, 0x12ff, 0x13ff, 0x14ff, 0x15ff, 0x16ff, 0x17ff, 0x18ff, 0x19ff, 0x1aff, 0x1bff, 0x1cff, 0x1dff, 0x1eff, 0x1fff, 0x20ff, 0x21ff, 0x22ff, 0x23ff, 0x24ff, 0x25ff, 0x26ff, 0x27ff, 0x28ff, 0x29ff, 0x2aff, 0x2bff, 0x2cff, 0x2dff, 0x2eff, 0x2fff, 0x30ff, 0x31ff, 0x32ff, 0x33ff, 0x34ff, 0x35ff, 0x36ff, 0x37ff, 0x38ff, 0x39ff, 0x3aff, 0x3bff, 0x3cff, 0x3dff, 0x3eff, 0x3fff, 0x8020,
    0x0000, 0x0100, 0x0200, 0x0300, 0x0400, 0x0500, 0x0600, 0x0700, 0x0800, 0x0900, 0x0a00, 0x0b00, 0x0c00, 0x0d00, 0x0e00, 0x0f00, 0x1000, 0x1100, 0x1200, 0x1300, 0x1400, 0x1500, 0x1600, 0x1700, 0x1800, 0x1900, 0x1a00, 0x1b00, 0x1c00, 0x1d00, 0x1e00, 0x1f00, 0x2000, 0x2100, 0x2200, 0x2300, 0x2400, 0x2500, 0x2600, 0x2700, 0x2800, 0x2900, 0x2a00, 0x2b00, 0x2c00, 0x2d00, 0x2e00, 0x2f00, 0x3000, 0x3100, 0x3200, 0x3300, 0x3400, 0x3500, 0x3600, 0x3700, 0x3800, 0x3900, 0x3a00, 0x3b00, 0x3c00, 0x3d00, 0x3e00, 0x3f00, 0x8020,
    0x00ff, 0x01ff, 0x02ff, 0x03ff, 0x04ff, 0x05ff, 0x06ff, 0x07ff, 0x08ff, 0x09ff, 0x0aff, 0x0bff, 0x0cff, 0x0dff, 0x0eff, 0x0fff, 0x10ff, 0x11ff, 0x12ff, 0x13ff, 0x14ff, 0x15ff, 0x16ff, 0x17ff, 0x18ff, 0x19ff, 0x1aff, 0x1bff, 0x1cff, 0x1dff, 0x1eff, 0x1fff, 0x20ff, 0x21ff, 0x22ff, 0x23ff, 0x24ff, 0x25ff, 0x26ff, 0x27ff, 0x28ff, 0x29ff, 0x2aff, 0x2bff, 0x2cff, 0x2dff, 0x2eff, 0x2fff, 0x30ff, 0x31ff, 0x32ff, 0x33ff, 0x34ff, 0x35ff, 0x36ff, 0x37ff, 0x38ff, 0x39ff, 0x3aff, 0x3bff, 0x3cff, 0x3dff, 0x3eff, 0x3fff, 0x8020,
    0x0000, 0x0100, 0x0200, 0x0300, 0x0400, 0x0500, 0x0600, 0x0700, 0x0800, 0x0900, 0x0a00, 0x0b00, 0x0c00, 0x0d00, 0x0e00, 0x0f00, 0x1000, 0x1100, 0x1200, 0x1300, 0x1400, 0x1500, 0x1600, 0x1700, 0x1800, 0x1900, 0x1a00, 0x1b00, 0x1c00, 0x1d00, 0x1e00, 0x1f00, 0x2000, 0x2100, 0x2200, 0x2300, 0x2400, 0x2500, 0x2600, 0x2700, 0x2800, 0x2900, 0x2a00, 0x2b00, 0x2c00, 0x2d00, 0x2e00, 0x2f00, 0x3000, 0x3100, 0x3200, 0x3300, 0x3400, 0x3500, 0x3600, 0x3700, 0x3800, 0x3900, 0x3a00, 0x3b00, 0x3c00, 0x3d00, 0x3e00, 0x3f00, 0x8020,
    0x00ff, 0x01ff, 0x02ff, 0x03ff, 0x04ff, 0x05ff, 0x06ff, 0x07ff, 0x08ff, 0x09ff, 0x0aff, 0x0bff, 0x0cff, 0x0dff, 0x0eff, 0x0fff, 0x10ff, 0x11ff, 0x12ff, 0x13ff, 0x14ff, 0x15ff, 0x16ff, 0x17ff, 0x18ff, 0x19ff, 0x1aff, 0x1bff, 0x1cff, 0x1dff, 0x1eff, 0x1fff, 0x20ff, 0x21ff, 0x22ff, 0x23ff, 0x24ff, 0x25ff, 0x26ff, 0x27ff, 0x28ff, 0x29ff, 0x2aff, 0x2bff, 0x2cff, 0x2dff, 0x2eff, 0x2fff, 0x30ff, 0x31ff, 0x32ff, 0x33ff, 0x34ff, 0x35ff, 0x36ff, 0x37ff, 0x38ff, 0x39ff, 0x3aff, 0x3bff, 0x3cff, 0x3dff, 0x3eff, 0x3fff, 0x8020,
    0x0000, 0x0100, 0x0200, 0x0300, 0x0400, 0x0500, 0x0600, 0x0700, 0x0800, 0x0900, 0x0a00, 0x0b00, 0x0c00, 0x0d00, 0x0e00, 0x0f00, 0x1000, 0x1100, 0x1200, 0x1300, 0x1400, 0x1500, 0x1600, 0x1700, 0x1800, 0x1900, 0x1a00, 0x1b00, 0x1c00, 0x1d00, 0x1e00, 0x1f00, 0x2000, 0x2100, 0x2200, 0x2300, 0x2400, 0x2500, 0x2600, 0x2700, 0x2800, 0x2900, 0x2a00, 0x2b00, 0x2c00, 0x2d00, 0x2e00, 0x2f00, 0x3000, 0x3100, 0x3200, 0x3300, 0x3400, 0x3500, 0x3600, 0x3700, 0x3800, 0x3900, 0x3a00, 0x3b00, 0x3c00, 0x3d00, 0x3e00, 0x3f00, 0x8020,
    0x00ff, 0x01ff, 0x02ff, 0x03ff, 0x04ff, 0x05ff, 0x06ff, 0x07ff, 0x08ff, 0x09ff, 0x0aff, 0x0bff, 0x0cff, 0x0dff, 0x0eff, 0x0fff, 0x10ff, 0x11ff, 0x12ff, 0x13ff, 0x14ff, 0x15ff, 0x16ff, 0x17ff, 0x18ff, 0x19ff, 0x1aff, 0x1bff, 0x1cff, 0x1dff, 0x1eff, 0x1fff, 0x20ff, 0x21ff, 0x22ff, 0x23ff, 0x24ff, 0x25ff, 0x26ff, 0x27ff, 0x28ff, 0x29ff, 0x2aff, 0x2bff, 0x2cff, 0x2dff, 0x2eff, 0x2fff, 0x30ff, 0x31ff, 0x32ff, 0x33ff, 0x34ff, 0x35ff, 0x36ff, 0x37ff, 0x38ff, 0x39ff, 0x3aff, 0x3bff, 0x3cff, 0x3dff, 0x3eff, 0x3fff, 0x8020,
    0x0000, 0x0100, 0x0200, 0x0300, 0x0400, 0x0500, 0x0600, 0x0700, 0x0800, 0x0900, 0x0a00, 0x0b00, 0x0c00, 0x0d00, 0x0e00, 0x0f00, 0x1000, 0x1100, 0x1200, 0x1300, 0x1400, 0x1500, 0x1600, 0x1700, 0x1800, 0x1900, 0x1a00, 0x1b00, 0x1c00, 0x1d00, 0x1e00, 0x1f00, 0x2000, 0x2100, 0x2200, 0x2300, 0x2400, 0x2500, 0x2600, 0x2700, 0x2800, 0x2900, 0x2a00, 0x2b00, 0x2c00, 0x2d00, 0x2e00, 0x2f00, 0x3000, 0x3100, 0x3200, 0x3300, 0x3400, 0x3500, 0x3600, 0x3700, 0x3800, 0x3900, 0x3a00, 0x3b00, 0x3c00, 0x3d00, 0x3e00, 0x3f00, 0x80ff,
    0x80ff,*/
};

int taille = sizeof(ANIMATION)/sizeof(*ANIMATION);

const PROGMEM byte tlc_order[][4] = {
  { 15, 14, 13, 11 }, /* y = 0 */
  { 12, 10,  9,  8 }, /* y = 1 */
  {  4,  5,  6,  7 }, /* y = 2 */
  {  0,  1,  2,  3 }, /* y = 3 */
};

/* Tableau de correspondance z -> pin transistor
   transistor_order[z] = pin transistor
 */
const PROGMEM byte transistor_order[] = {
  5, /* z = 0 */
  7, /* z = 1 */
  4, /* z = 2 */
  6, /* z = 3 */
};

//Valeur des LEDS (0 - 255)

byte values[4][4][4];
int anim_position = 0;
bool manual_mode = false;
long long fintempo = 0;

void setLed(byte x, byte y, byte z, byte eclat)
{
  values[z][y][x] = eclat;
}

byte getLed(byte x, byte y, byte z)
{
  return values[z][y][x];
}

void reset()
{
  for (byte z = 0; z < 4; z++) {
    for (byte y = 0; y < 4; y++) {
      for (byte x = 0; x < 4; x++) {
        values[z][y][x] = 0;
      }
    }
  }
}

void read_serial_frame() {
  byte command_count;

  if (Serial.available()) {
    command_count = Serial.read();
    
    manual_mode = (command_count > 0);

    if (manual_mode) {
      for (byte i = 0; i < command_count; i++) {
        unsigned int command;
        Serial.write(0x42);
        Serial.flush();

        while (!Serial.available());
        command = (Serial.read() & 0xFF) << 8;

        while (!Serial.available());
        command |= (Serial.read() & 0xFF);

        handle_command(command);
      }
    } else {
      anim_position = 0;
    }
  }
}

void read_ROM_frame() {
  unsigned int command;

  for (;;) {
    if (anim_position >= taille) {
      anim_position = 0;
      reset();
    }

    command = pgm_read_word(&ANIMATION[anim_position]);
    
    anim_position++;
    
    if (handle_command(command))
      return;
  }
}

bool handle_command(unsigned int command) {
  byte x, y, z, eclat;
  
  if ((command & 0x8000) == 0) {
    x = (command >> 8) & 3;
    y = (command >> 10) & 3;
    z = (command >> 12) & 3;
    eclat = command & 0xFF;

    setLed(x, y, z, eclat);
    return false;
  } else {
    if (command & 0x4000)
      reset();
    else
      fintempo = millis() + (command & 0x3FFF);
    return true;
  }
}

/* Parcourt les 4 étages */
void refresh()
{
  for (byte z = 0; z < 4; z++) {
    byte tr = pgm_read_byte(&transistor_order[z]);

    for (byte y = 0; y < 4; y++) {
      for (byte x = 0; x < 4; x++) {
        byte eclat = getLed(x, y, z);
        byte order = pgm_read_byte(&tlc_order[y][x]);
        Tlc.set(order, map(eclat, 0, 255, 0, 4095));
      }
    }

    Tlc.update();
    delay(1);
    digitalWrite(tr, LOW);
    delay(2);
    digitalWrite(tr, HIGH);
  }
}

void setup()
{
  Serial.begin(115200);

  pinMode(4, OUTPUT);
  pinMode(5, OUTPUT);
  pinMode(6, OUTPUT);
  pinMode(7, OUTPUT);

  digitalWrite(4, HIGH);
  digitalWrite(5, HIGH);
  digitalWrite(6, HIGH);
  digitalWrite(7, HIGH);

  Tlc.init();
}

void loop()
{
  read_serial_frame();

  if (!manual_mode)
    read_ROM_frame();

  do {
    refresh();
  } while (millis() < fintempo);
}
